<?xml version="1.0"?>
<launch>

  <arg name="sim"			default="false"/>
  <arg name="scene"			default=""/>
  <arg name="joint_state_frequency"	default="50"/>
  <arg name="robot_state_frequency"	default="50"/>
  <arg name="moveit_config"		default="$(find aist_moveit_config)"/>
  <arg name="rviz_config"		default=""/>

  <!-- Setup "aist" configuration -->
  <arg name="config"		value="aist"/>
  <arg name="gazebo_init_args"	value="-J a_bot_shoulder_pan_joint 1.5708
				       -J a_bot_shoulder_lift_joint -2.1
				       -J a_bot_elbow_joint 1.4
				       -J a_bot_wrist_1_joint -0.85
				       -J a_bot_wrist_2_joint -1.5708
				       -J a_bot_wrist_3_joint 0.0
				       -J b_bot_shoulder_pan_joint 1.5708
				       -J b_bot_shoulder_lift_joint -2.1
				       -J b_bot_elbow_joint 1.4
				       -J b_bot_wrist_1_joint -0.85
				       -J b_bot_wrist_2_joint -1.5708
				       -J b_bot_wrist_3_joint 0.0"/>
  <arg name="prefixes"		value="a_bot_, b_bot_, a_bot_"/>
  <arg name="devices"		value="ur5, ur5, robotiq_85"/>
  <arg name="controllers"	value="ur, ur, ros"/>
  <arg name="drivers"		value="ur, ur, cmodel"/>
  <arg name="driver_args"	value="10.66.171.52, 50003;
				       10.66.171.51, 50002;"/>

  <!-- Bringup robots -->
  <include file="$(find aist_bringup)/launch/include/connect_robots.launch">
    <arg name="robot_description_file"
	 value="$(find aist_description
		)/scenes/urdf/$(arg config)_base_scene.urdf.xacro
		scene:=$(arg scene)"/>
    <arg name="sim"			value="$(arg sim)"/>
    <arg name="joint_state_frequency"	value="$(arg joint_state_frequency)"/>
    <arg name="gazebo_init_args"	value="$(arg gazebo_init_args)"/>
    <arg name="prefixes"		value="$(arg prefixes)"/>
    <arg name="devices"			value="$(arg devices)"/>
    <arg name="controllers"		value="$(arg controllers)"/>
    <arg name="drivers"			value="$(arg drivers)"/>
    <arg name="driver_args"		value="$(arg driver_args)"/>
  </include>

  <!-- Start MoveIt! -->
  <include file="$(find aist_bringup)/launch/include/move_group.launch">
    <arg name="robot_state_frequency"	value="$(arg robot_state_frequency)"/>
    <arg name="moveit_config"		value="$(arg moveit_config)"/>
    <arg name="rviz_config"		value="$(arg rviz_config)"/>
  </include>

  <!-- Set names of realsense cameras -->
  <arg name="camera0_name"		value="a_bot_inside_camera"/>
  <arg name="camera1_name"		value="a_bot_outside_camera"/>

  <!-- Launch other hardware drivers -->
  <group if="$(eval not sim)">

    <!-- Drivers for the force sensors -->
    <include file="$(find aist_ftsensor)/launch/aist_ftsensor.launch">
      <arg name="robot_name"	value="a_bot"/>
    </include>
    <include file="$(find aist_ftsensor)/launch/aist_ftsensor.launch">
      <arg name="robot_name"	value="b_bot"/>
    </include>

    <!-- Launch fastening tools -->
    <node name="suction_controller" pkg="o2as_fastening_tools"
	  type="suction_controller.py" output="screen">
      <param name="config_dir"		value="$(find
					       o2as_fastening_tools)/config"/>
      <param name="suction_control"	value="suction_control"/>
      <param name="operation_mode"	value="operation_mode"/>
    </node>

    <!-- Launch PhoXi camera -->
    <include file="$(find aist_phoxi_camera)/launch/run.launch">
      <arg name="camera_name"		value="a_phoxi_m_camera"/>
      <arg name="id"			value="2018-09-016-LC3"/>
      <arg name="frame"			value="calibrated_a_phoxi_m_camera"/>
    </include>

    <!-- Launch RealSense cameras and associated depth filters -->
    <arg name="camera0_serial_no"	default="636203005853"/>
    <arg name="camera1_serial_no"	default="636203005303"/>
    <arg name="camera_width"		default="640"/>
    <arg name="camera_height"		default="480"/>
    <arg name="fps"			default="30"/>
    <arg name="manager"			default=""/>

    <!-- Launch RealSense cameras -->
    <include file="$(find realsense2_camera)/launch/rs_camera.launch">
      <arg name="serial_no"		value="$(arg camera0_serial_no)"/>
      <arg name="camera"		value="$(arg camera0_name)"/>
      <arg name="tf_prefix"		value="calibrated_$(arg camera0_name)"/>
      <arg name="enable_depth"		value="true"/>
      <arg name="enable_infra1"		value="true"/>
      <arg name="enable_infra2"		value="false"/>
      <arg name="enable_pointcloud"	value="false"/>
      <arg name="align_depth"		value="true"/>
      <arg name="depth_width"		value="$(arg camera_width)"/>
      <arg name="depth_height"		value="$(arg camera_height)"/>
      <arg name="depth_fps"		value="$(arg fps)"/>
      <arg name="infra_width"		value="$(arg camera_width)"/>
      <arg name="infra_height"		value="$(arg camera_height)"/>
      <arg name="infra_fps"		value="$(arg fps)"/>
      <arg name="color_width"		value="$(arg camera_width)"/>
      <arg name="color_height"		value="$(arg camera_height)"/>
      <arg name="color_fps"		value="$(arg fps)"/>
      <arg name="enable_streaming"	value="true"/>
      <arg name="manager"		value="$(arg manager)"
	   unless="$(eval manager == '')"/>
    </include>

    <include file="$(find realsense2_camera)/launch/rs_camera.launch">
      <arg name="serial_no"		value="$(arg camera1_serial_no)"/>
      <arg name="camera"		value="$(arg camera1_name)"/>
      <arg name="tf_prefix"		value="calibrated_$(arg camera1_name)"/>
      <arg name="enable_depth"		value="true"/>
      <arg name="enable_infra1"		value="true"/>
      <arg name="enable_infra2"		value="false"/>
      <arg name="enable_pointcloud"	value="false"/>
      <arg name="align_depth"		value="true"/>
      <arg name="depth_width"		value="$(arg camera_width)"/>
      <arg name="depth_height"		value="$(arg camera_height)"/>
      <arg name="depth_fps"		value="$(arg fps)"/>
      <arg name="infra_width"		value="$(arg camera_width)"/>
      <arg name="infra_height"		value="$(arg camera_height)"/>
      <arg name="infra_fps"		value="$(arg fps)"/>
      <arg name="color_width"		value="$(arg camera_width)"/>
      <arg name="color_height"		value="$(arg camera_height)"/>
      <arg name="color_fps"		value="$(arg fps)"/>
      <arg name="enable_streaming"	value="true"/>
      <arg name="manager"		value="$(arg manager)"
	   unless="$(eval manager == '')"/>
    </include>

  </group>

  <!-- Launch camera multiplexer -->
  <node name="camera_multiplexer"
  	pkg="aist_camera_multiplexer" type="aist_camera_multiplexer"
  	output="screen">
    <rosparam param="camera_names" subst_value="true">
      [$(arg camera0_name), $(arg camera1_name)]
    </rosparam>

    <remap from="/camera_info0"	to="$(arg camera0_name)/color/camera_info"/>
    <remap from="/image0"	to="$(arg camera0_name)/color/image_raw"/>
    <remap from="/depth0"	to="$(arg camera0_name
				    )/aligned_depth_to_color/image_raw"/>

    <remap from="/camera_info1"	to="$(arg camera1_name)/color/camera_info"/>
    <remap from="/image1"	to="$(arg camera1_name)/color/image_raw"/>
    <remap from="/depth1"	to="$(arg camera1_name
				    )/aligned_depth_to_color/image_raw"/>
  </node>

</launch>
